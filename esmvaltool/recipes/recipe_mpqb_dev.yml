# ESMValTool
# recipe_mpqb_sm.yml
---
documentation:
  description: |
    Recipe for the MPQB (C3S_511) for development (June 2020) this recipe should contain
    all diagnostics available in the  MPQB framework. It can be run on a set of datasets
    that span a short time period, to decrease completion time.

  authors:
    - crezee_bas


################################################

histogram_settings: &histogram_settings
  histtype: step
  vmin: 0.0
  vmax: 0.7
  number_of_bars: 140
  logarithmic: false
  y0: 0.0
  y1: 0.03

histogram_settings_zoom: &histogram_settings_zoom
  histtype: step
  vmin: -0.1
  vmax: 0.1
  number_of_bars: 100
  logarithmic: false

################################################
################################################
################################################

datasets_dev: &datasets_dev
  additional_datasets:
    - {dataset: ERA-Interim-Land, type: reanaly, project: OBS6, mip: Lmon,
       version: 1, tier: 3, start_year: 2008, end_year: 2010}
    - {dataset: cds-era5-land-monthly, type: reanaly, project: OBS, mip: Lmon,
       version: 1, tier: 3, start_year: 2008, end_year: 2010}
    - {dataset: cds-era5-monthly, type: reanaly, project: OBS, mip: Lmon,
       version: 1, tier: 3, start_year: 2008, end_year: 2010}
    - {dataset: MERRA2, type: reanaly, project: OBS6, mip: Lmon,
       version: 1, tier: 3, start_year: 2008, end_year: 2010}


preprocessors:
  pp_dev:
    custom_order: true
    annual_statistics:
      operator: mean
    regrid:
      target_grid: 0.25x0.25
      scheme: nearest
    regrid_time:  # this is needed for a fully homogeneous time coordinate
      frequency: mon

  pp_dev_line:
    regrid_time:  # this is needed for a fully homogeneous time coordinate
      frequency: mon
    area_statistics:
      operator: mean


diagnostics:
  auxmaps:
    description: auxiliary maps (trend; climatology)
    variables:
      sm:
        preprocessor: pp_dev
        mip: Lmon
    scripts:
      aux_maps:
        script: mpqb/mpqb_auxmaps.py
    <<: *datasets_dev
  resolution:
    variables:
      sm:
        mip: Lmon
    scripts:
      mpqb:
        script: mpqb/mpqb_resolution.py
    <<: *datasets_dev
  mapplots:
    variables:
      sm:
        preprocessor: pp_dev
        mip: Lmon
    scripts:
      mpqb:
        reference_dataset: cds-era5-land-monthly
        script: mpqb/mpqb_comparison.py
    <<: *datasets_dev
  taylor:
    variables:
      sm:
        preprocessor: pp_dev
        mip: Lmon
    scripts:
      taylor:
        reference_dataset: cds-era5-land-monthly
        script: mpqb/taylordiagram.py
    <<: *datasets_dev
  lineplots:
    variables:
      sm:
        preprocessor: pp_dev_line
        mip: Lmon
    scripts:
      lineplot:
        script: mpqb/mpqb_lineplot.py
    <<: *datasets_dev
  histogram_original:
    variables:
      sm:
        preprocessor: pp_dev
        mip: Lmon
    scripts:
      hist:
        script: mpqb/mpqb_histogram.py
        <<: *histogram_settings
    <<: *datasets_dev
