# ESMValTool
# recipe_mpqb.yml
---
documentation:
  description: |
    Test recipe for the MPQB (C3S_511) for snowcover

  authors:
    - mueller_benjamin


################################################
# Define some default parameters using anchors #
################################################

mmm_stat: &mmm_stat
  multi_model_statistics:
    span: overlap
    statistics: [mean]
    
sel_NH: &NH
  extract_region:
    start_longitude: -180.
    end_longitude: 180.
    start_latitude: 25.
    end_latitude: 85.

mpqbregridder: &mpqbregridder
  regrid:
#    target_grid: CDS-ERA5LAND-SNOWCOVER
    target_grid: 0.1x0.1
    scheme: area_weighted
#  monthly_statistics:
#    operator: mean

# input data
default_pp_maps: &pp_maps
  custom_order: true
  mask_fillvalues:
    threshold_fraction: 0.0
  <<: *mpqbregridder
#  <<: *NH
  mask_landsea:
    mask_out: sea
  <<: *mmm_stat

# Additional preprocessor for
# line plots
default_pp_line: &pp_line
  custom_order: true
  mask_fillvalues:
    threshold_fraction: 0.0
  area_statistics:
    operator: mean

################################################
################################################
################################################

datasets:

  - {
  dataset: CDS-ERA5LAND-SNOWCOVER,
  type: reanaly,
  version: V1pp,
  alias: ERA5-Land,
  }
  
  - {
  dataset: GlobSnow,
  type: sat,
  version: V2.1pp,
  alias: GlobSnow,
  }
  
#  - {
#  dataset: TERRA-MODIS-SNOWCOVER,
#  type: sat,
#  version: MOD10CMpp,
#  alias: TERRA/MODIS,
#  }
#  
#  - {
#  dataset: GSL-SNOWCOVER,
#  type: sat,
#  version: v01r01pp,
#  alias: Global Snow Lab,
#  }
  

preprocessors:
  pp_tmp:
    annual_statistics:
      operator: mean
    
  pp_mpqb_snc:
    <<: *pp_maps

  pp_lineplots:
    <<: *pp_maps
    <<: *pp_line

  pp_lineplots_std:
    anomalies:
      period: monthly
#      standardize: true
    <<: *pp_maps
    <<: *pp_line

  pp_mpqb_yearmean:
    <<: *pp_maps
    annual_statistics:
      operator: mean

  pp_mpqb_yearmin:
    <<: *pp_maps
    annual_statistics:
      operator: min

  pp_mpqb_yearmax:
    <<: *pp_maps
    annual_statistics:
      operator: max

  pp_mpqb_yearstddev:
    <<: *pp_maps
    annual_statistics:
      operator: std_dev

snc_def: &sncdef
  project: OBS
  mip: LImon
  tier: 3
  start_year: 2003
  end_year: 2011

diagnostics:

  histogram:
    description: histogram for 0.1x0.1 gridded data
    variables:
      snc:
        preprocessor: pp_mpqb_snc
        <<: *sncdef
    scripts:
      mpqb:
        script: mpqb/mpqb_histogram.py
        vmin: 0
        vmax: 100
        number_of_bars: 20
        logarithmic: False
        

