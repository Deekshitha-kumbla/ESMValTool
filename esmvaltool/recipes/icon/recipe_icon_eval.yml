# ESMValTool
# icon/recipe_icon_eval.yml

documentation:
  title: Evaluation of native ICON model output.

  description: Evaluate arbitrary ICON simulations.

  authors:
    - schlund_manuel

  references:
    - acknow_project


# Please specify the start and end years here
YEARS: &years
  start_year: 2014
  end_year: 2014

# Please specify the ICON simulation you want to evaluate
ICON_2D: &icon_2d
  - <<: *years
    project: ICON
    dataset: ICON
    component: atm
    exp: amip
    grid: R2B5
    ensemble: r1v1i1p1l1f1
    var_type: atm_2d_ml
    version: icon-2.6.1
ICON_3D: &icon_3d
  - <<: *years
    project: ICON
    dataset: ICON
    component: atm
    exp: amip
    grid: R2B5
    ensemble: r1v1i1p1l1f1
    var_type: atm_3d_ml
    version: icon-2.6.1

# Please specify the reference dataset
REF_2D: &ref_2d
  - <<: *years
    project: native6
    dataset: ERA5
    type: reanaly
    version: v1
    tier: 3
REF_3D: &ref_3d
  - <<: *years
    project: native6
    dataset: ERA5
    type: reanaly
    version: v1
    tier: 3

# Please specify the correct preprocessors for the reference simulation
REF_PREPROC_2D: &ref_preproc_2d
  # preprocessor: regrid_icon        # Use if reference dataset is another ICON run
  preprocessor: regrid_nonicon     # Use if reference dataset is not an ICON run (e.g., observations)
REF_PREPROC_3D: &ref_preproc_3d
  # preprocessor: regrid_3d_icon     # Use if reference dataset is another ICON run
  preprocessor: regrid_3d_nonicon  # Use if reference dataset is not an ICON run (e.g., observations)
REF_NAME: &ref_name
  reference:
    # dataset: ICON  # Use if reference dataset is another ICON run
    dataset: ERA5  # Use if reference dataset is not an ICON run (e.g., observations)


# Please do not change anything below this line


SCRIPT_TIME_SERIES_REF: &script_time_series_ref
  script: icon/plot_timeseries.py

SCRIPT_MAP_REF: &scrip_map_ref
  <<: *ref_name
  script: icon/plot_map.py

SCRIPT_ZONAL_MEAN_REF: &script_zonal_mean_ref
  <<: *ref_name
  script: icon/plot_zonal_mean.py


preprocessors:

  regrid_icon:
    regrid: &regrid_icon
      target_grid: 2x2
      scheme: unstructured_nearest
      lon_offset: false

  regrid_nonicon:
    regrid: &regrid_nonicon
      target_grid: 2x2
      scheme: linear
      lon_offset: false

  regrid_3d_icon:
    custom_order: true
    climate_statistics:
      operator: mean
    extract_levels:
      levels: {cmor_table: CMIP6, coordinate: plev39}
      scheme: linear
      coordinate: air_pressure
    regrid: *regrid_icon

  regrid_3d_nonicon:
    custom_order: true
    climate_statistics:
      operator: mean
    extract_levels:
      levels: {cmor_table: CMIP6, coordinate: plev39}
      scheme: linear
      coordinate: air_pressure
    regrid: *regrid_nonicon


diagnostics:

  tas_ref:
    variables:
      icon:
        short_name: tas
        mip: Amon
        preprocessor: regrid_icon
        additional_datasets: *icon_2d
      nonicon:
        <<: *ref_preproc_2d
        short_name: tas
        mip: Amon
        additional_datasets: *ref_2d
    scripts:
      plot:
        script: icon/plot_native_model_map.py
      time_series:
        <<: *script_time_series_ref
      map:
        <<: *scrip_map_ref
        plot_kwargs_abs:
          levels: [-50., -42., -34., -26., -18., -10., -2., 6., 14., 22., 30.]
          extend: both
        plot_kwargs_bias:
          levels: [-10., -8., -6., -4., -2., 0., 2., 4., 6., 8., 10.]
          extend: both

  clt_ref:
    variables:
      icon:
        short_name: clt
        mip: Amon
        preprocessor: regrid_icon
        additional_datasets: *icon_2d
      nonicon:
        <<: *ref_preproc_2d
        short_name: clt
        mip: Amon
        additional_datasets: *ref_2d
    scripts:
      time_series:
        <<: *script_time_series_ref
      map:
        <<: *scrip_map_ref
        plot_kwargs_abs:
          levels: [0., 10., 20., 30., 40., 50., 60., 70., 80., 90., 100.]
        plot_kwargs_bias:
          levels: [-40., -32., -24., -16., -8., 0., 8., 16., 24., 32., 40.]
          extend: both

  pr_ref:
    variables:
      icon:
        short_name: pr
        mip: Amon
        preprocessor: regrid_icon
        additional_datasets: *icon_2d
      nonicon:
        <<: *ref_preproc_2d
        short_name: pr
        mip: Amon
        additional_datasets: *ref_2d
    scripts:
      time_series:
        <<: *script_time_series_ref
      map:
        <<: *scrip_map_ref
        plot_kwargs_abs:
          levels: [0., 0.75, 1.5, 2.25, 3., 3.75, 4.5, 5.25, 6., 6.75, 7.5]
          extend: max
        plot_kwargs_bias:
          levels: [-7.5, -6., -4.5, -3., -1.5, 0., 1.5, 3., 4.5, 6., 7.5]
          extend: both

  prw_ref:
    variables:
      icon:
        short_name: prw
        mip: Amon
        preprocessor: regrid_icon
        additional_datasets: *icon_2d
      nonicon:
        <<: *ref_preproc_2d
        short_name: prw
        mip: Amon
        additional_datasets: *ref_2d
    scripts:
      time_series:
        <<: *script_time_series_ref
      map:
        <<: *scrip_map_ref
        plot_kwargs_abs:
          levels: [0., 6., 12., 18., 24., 30., 36., 42., 48., 54., 60.]
          extend: max
        plot_kwargs_bias:
          levels: [-10., -8., -6., -4., -2., 0., 2., 4., 6., 8., 10.]
          extend: both

  rsdt_ref:
    variables:
      icon:
        short_name: rsdt
        mip: Amon
        preprocessor: regrid_icon
        additional_datasets: *icon_2d
      nonicon:
        <<: *ref_preproc_2d
        short_name: rsdt
        mip: Amon
        additional_datasets: *ref_2d
    scripts:
      time_series:
        <<: *script_time_series_ref
      map:
        <<: *scrip_map_ref
        plot_kwargs_abs:
          levels: [150., 180., 210., 240., 270., 300., 330., 360., 390., 420., 450.]
          extend: both
        plot_kwargs_bias:
          levels: [-2.5, -2., -1.5, -1., -0.5, 0., 0.5, 1., 1.5, 2., 2.5]
          extend: both

  clivi_ref:
    variables:
      icon:
        short_name: clivi
        mip: Amon
        preprocessor: regrid_icon
        additional_datasets: *icon_2d
      nonicon:
        <<: *ref_preproc_2d
        short_name: clivi
        mip: Amon
        additional_datasets: *ref_2d
    scripts:
      time_series:
        <<: *script_time_series_ref
      map:
        <<: *scrip_map_ref
        plot_kwargs_abs:
          levels: [0.0, 0.015, 0.03, 0.045, 0.06, 0.075, 0.09, 0.105, 0.12, 0.135, 0.15]
          extend: max
        plot_kwargs_bias:
          levels: [-0.15, -0.12, -0.09, -0.06, -0.03, 0.0, 0.03, 0.06, 0.09, 0.12, 0.15]
          extend: both

  ta_ref:
    variables:
      icon:
        short_name: ta
        mip: Amon
        preprocessor: regrid_3d_icon
        additional_datasets: *icon_3d
      nonicon:
        <<: *ref_preproc_3d
        short_name: ta
        mip: Amon
        additional_datasets: *ref_3d
    scripts:
      zonal_mean:
        <<: *script_zonal_mean_ref
        plot_kwargs_abs:
          levels: [-90., -75., -60., -45., -30., -15., 0., 15., 30.]
        plot_kwargs_bias:
          levels: [-8., -6., -4., -2., 0., 2., 4., 6., 8.]
          extend: both

  hus_ref:
    variables:
      icon:
        short_name: hus
        mip: Amon
        preprocessor: regrid_3d_icon
        additional_datasets: *icon_3d
      nonicon:
        <<: *ref_preproc_3d
        short_name: hus
        mip: Amon
        additional_datasets: *ref_3d
    scripts:
      zonal_mean:
        <<: *script_zonal_mean_ref
        axes_kwargs:
          set_ylim: [[1000.0, 400.0]]
        plot_kwargs_abs:
          levels: [0., 2.5, 5., 7.5, 10., 12.5, 15., 17.5]
        plot_kwargs_bias:
          levels: [-1.2, -0.8, -0.4, 0., 0.4, 0.8, 1.2]
          extend: both
        show_y_minorticks: true
