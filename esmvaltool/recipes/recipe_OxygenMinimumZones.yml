###############################################################################
# recipe_OceanPhysics.yml
---
documentation:
  description: |
    Recipe to demonstrate several simple plots based on the ocean oxygen.
    This work based on the BGC-val toolkit GMD-2018-103.
    Written by Lee de Mora, Plymouth Marine Laboratory

  authors:
    - ledm

  references:
    - BGC-val:gmd-2018-103

  projects:
    - ukesm


datasets:
    - {dataset: CESM1-BGC,          project: CMIP5,  mip: Oyr,  exp: historical,  ensemble: r1i1p1,  start_year: 2001,  end_year: 2004}
    - {dataset: CMCC-CESM,        project: CMIP5,  mip: Oyr,  exp: historical,  ensemble: r1i1p1,  start_year: 2001,  end_year: 2004}
    - {dataset: HadGEM2-ES,       project: CMIP5,  mip: Oyr,  exp: historical,  ensemble: r1i1p1,  start_year: 2001,  end_year: 2004}
    - {dataset: HadGEM2-CC,       project: CMIP5,  mip: Oyr,  exp: historical,  ensemble: r1i1p1,  start_year: 2001,  end_year: 2004}
    - {dataset: MPI-ESM-LR,       project: CMIP5,  mip: Oyr,  exp: historical,  ensemble: r1i1p1,  start_year: 2001,  end_year: 2004}
    - {dataset: IPSL-CM5A-LR,       project: CMIP5,  mip: Oyr,  exp: historical,  ensemble: r1i1p1,  start_year: 2001,  end_year: 2004}
    - {dataset: IPSL-CM5A-MR,       project: CMIP5,  mip: Oyr,  exp: historical,  ensemble: r1i1p1,  start_year: 2001,  end_year: 2004}
    - {dataset: IPSL-CM5B-LR,       project: CMIP5,  mip: Oyr,  exp: historical,  ensemble: r1i1p1,  start_year: 2001,  end_year: 2004}
    - {dataset: NorESM1-ME,       project: CMIP5,  mip: Oyr,  exp: historical,  ensemble: r1i1p1,  start_year: 2001,  end_year: 2004}




    # # Doesn't work on pmpmc:, uses too much memory
    #
    #     - {dataset: MPI-ESM-MR,       project: CMIP5,  mip: Oyr,  exp: historical,  ensemble: r1i1p1,  start_year: 2001,  end_year: 2004}
    #         - {dataset: MRI-ESM1,       project: CMIP5,  mip: Oyr,  exp: historical,  ensemble: r1i1p1,  start_year: 2001,  end_year: 2004}
  # working datasets
    # - {dataset: CESM1-BGC,          project: CMIP5,  mip: Oyr,  exp: historical,  ensemble: r1i1p1,  start_year: 2001,  end_year: 2004}
    # - {dataset: CMCC-CESM,        project: CMIP5,  mip: Oyr,  exp: historical,  ensemble: r1i1p1,  start_year: 2001,  end_year: 2004}
    # - {dataset: HadGEM2-ES,       project: CMIP5,  mip: Oyr,  exp: historical,  ensemble: r1i1p1,  start_year: 2001,  end_year: 2004}
    # - {dataset: HadGEM2-CC,       project: CMIP5,  mip: Oyr,  exp: historical,  ensemble: r1i1p1,  start_year: 2001,  end_year: 2004}
    #     - {dataset: IPSL-CM5A-LR,       project: CMIP5,  mip: Oyr,  exp: historical,  ensemble: r1i1p1,  start_year: 2001,  end_year: 2004}
    # - {dataset: IPSL-CM5A-MR,       project: CMIP5,  mip: Oyr,  exp: historical,  ensemble: r1i1p1,  start_year: 2001,  end_year: 2004}
#     - {dataset: IPSL-CM5B-LR,       project: CMIP5,  mip: Oyr,  exp: historical,  ensemble: r1i1p1,  start_year: 2001,  end_year: 2004}
    # - {dataset: MPI-ESM-LR,       project: CMIP5,  mip: Oyr,  exp: historical,  ensemble: r1i1p1,  start_year: 2001,  end_year: 2004}
    # - {dataset: MPI-ESM-MR,       project: CMIP5,  mip: Oyr,  exp: historical,  ensemble: r1i1p1,  start_year: 2001,  end_year: 2004}
    # - {dataset: MRI-ESM1,       project: CMIP5,  mip: Oyr,  exp: historical,  ensemble: r1i1p1,  start_year: 2001,  end_year: 2004}
    # - {dataset: NorESM1-ME,       project: CMIP5,  mip: Oyr,  exp: historical,  ensemble: r1i1p1,  start_year: 2001,  end_year: 2004}


# buggy:
    # - {dataset: GFDL-ESM2G,       project: CMIP5,  mip: Oyr,  exp: historical,  ensemble: r1i1p1,  start_year: 2001,  end_year: 2004}
    # - {dataset: CNRM-CM5,         project: CMIP5,  mip: Oyr,  exp: historical,  ensemble: r1i1p1,  start_year: 2001,  end_year: 2004}

# o2 range is insanely high: (1-4 mol/m3)
    # - {dataset: BNU-ESM,          project: CMIP5,  mip: Oyr,  exp: historical,  ensemble: r1i1p1,  start_year: 2001,  end_year: 2004}


# Iregular grid:



# No oxygen data on jasmin:
  # - {dataset: CanESM2, project: CMIP5, mip: Oyr, exp: historical, ensemble: r1i1p1, start_year: 2001, end_year: 2004}
  # - {dataset: GISS-E2-H, project: CMIP5, mip: Oyr, exp: historical, ensemble: r1i1p1, start_year: 2001, end_year: 2004}
  # - {dataset: HadGEM2-AO, project: CMIP5, mip: Oyr, exp: historical, ensemble: r1i1p1, start_year: 2001, end_year: 2004}
  # - {dataset: HadCM3, project: CMIP5, mip: Oyr, exp: historical, ensemble: r1i1p1, start_year: 2001, end_year: 2004}
  # - {dataset: CanCM4, project: CMIP5, mip: Oyr, exp: historical, ensemble: r1i1p1, start_year: 2001, end_year: 2004}
  # - {dataset: CSIRO-Mk3-6-0, project: CMIP5, mip: Oyr, exp: historical, ensemble: r1i1p1, start_year: 2001, end_year: 2004}

preprocessors:
  # --------------------------------------------------
  # Time series preprocessors
  # --------------------------------------------------

# Cabre Figure 1 a & 1 b
  prep_depth_layers:
    custom_order: true
    extract_levels:
      levels: [500., 1000.]
      scheme: linear_horizontal_extrapolate_vertical
    # extract_region:
    #   start_longitude: 120.
    #   end_longitude: 310.
    #   start_latitude: -60.
    #   end_latitude: 60.
    time_average:
    regrid:
      target_grid: 1x1
      scheme: linear
#    multi_model_statistics:
#      span: overlap
#      statistics: [mean ]

# Cabre Figure 1 c
  prep_transect_South: # For extracting a transect
    custom_order: true
    time_average:
    extract_region:
      start_longitude: 140.
      end_longitude: 310.
      start_latitude: -20.
      end_latitude: 0.
    regrid:
      target_grid: 1x1
      scheme: linear
    extract_transect: # Pacific Equator
      latitude: -10.
      longitude: [140., 310.]

# Cabre Figure 1 d
  prep_transect_North: # For extracting a transect
    custom_order: true
    time_average:
    extract_region: #can't extrat region
      start_longitude: 140.
      end_longitude: 290.
      start_latitude: 0.
      end_latitude: 20.
    regrid:
      target_grid: 1x1
      scheme: linear
    extract_transect: # Pacific Equator
      latitude: 10.
      longitude: [140., 290.]


  # prep_global_volume_average: # For 2D fields
  #   custom_order: true
  #   mask_above_threshold:
  #     threshold: 0.2
  #   average_volume:
  #     coord1: longitude
  #     coord2: latitude
  #     coordz: depth
  #
  # prep_global_volume_average: # For 2D fields
  #   custom_order: true
  #   mask_above_threshold:
  #     threshold: 0.2
  #   average_volume:
  #     coord1: longitude
  #     coord2: latitude
  #     coordz: depth
  #
  # prep_profile_pacific_equator: # For a regional profile
  #   extract_region:
  #     start_longitude: 120.
  #     end_longitude: 300.
  #     start_latitude: -10.
  #     end_latitude: 10.
  #   average_region:
  #     coord1: longitude
  #     coord2: latitude

# OMZ metrics:
#  oxygen concentration at 500m/1000m like cabre
#  Oxygen concentration along 15 N/15 South slices.
#  Oxygen minimum over z
#  OMZ volume
# Apparent oxygen usage - talk to Oli Andrews from Bristol.
# Zonal average of 10N-10S against WOA data.
# Vertical profiles of average oxygen region.
# Colour scale for anoxic/oxic etc
diagnostics:
  # --------------------------------------------------
  # Time series diagnostics
  # --------------------------------------------------
  cabre1ab:
    description: Oxygen concentration at 500m, 1000m.
    variables:
      o2:
        preprocessor: prep_depth_layers
        field: TO3Y
    additional_datasets:
      # /data/sthenno1/scratch/ledm/Observations/WOA/Oxygen_All_Periods/obsdata/Tier2/WOA/OBS_WOA_clim_TO3M_o2_000000-000000.nc
      - {dataset: WOA,  project: obs4mips,  level: L3,  version: clim,  tier: 3, start_year: 2000,  end_year: 2000,}
    scripts:
      depth_layers:
        script: ocean/diagnostic_maps.py
        thresholds: [0.03, 0.05, 0.08]

  cabre1c:
    description: Oxygen concentration transect, 10 North Pacific.
    variables:
      o2:
        preprocessor: prep_transect_South
        field: TO3Y
    scripts:
      depth_layers:
        script: ocean/diagnostic_transects.py
        thresholds: [0.03, 0.05, 0.08]

  cabre1d:
    description: Oxygen concentration transect 10 South Pacific.
    variables:
      o2:
        preprocessor: prep_transect_North
        field: TO3Y
    scripts:
      depth_layers:
        script: ocean/diagnostic_transects.py
        thresholds: [0.03, 0.05, 0.08]


  model_vs_obs:
    description: Oxygen concentration at 500m, 1000m.
    variables:
      o2:
        preprocessor: prep_depth_layers
        field: TO3Y
    additional_datasets:
      # /data/sthenno1/scratch/ledm/Observations/WOA/Oxygen_All_Periods/obsdata/Tier2/WOA/OBS_WOA_clim_TO3M_o2_000000-000000.nc
      - {dataset: WOA,  project: obs4mips,  level: L3,  version: clim,  tier: 3, start_year: 2000,  end_year: 2000,}
    scripts:
      model_vs_obs:
         script: ocean/diagnostic_model_vs_obs.py
         observational_dataset: {dataset: WOA, project: obs4mips,}
