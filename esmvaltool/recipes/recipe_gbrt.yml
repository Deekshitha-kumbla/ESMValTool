# recipe_gbrt.yml
---
documentation:

  description: |
    Performs GBRT (Gradient Boosted Regression Trees) for climate predictions.

  authors:
    - schl_ma

  references:
    null

  projects:
    - crescendo


datasets:
  - {dataset: CanESM2}
  - {dataset: MPI-ESM-LR}


preprocessors:

  time_average:
    time_average: null


diagnostics:

  diag_dummy:
    variables:
      tas:
        project: CMIP5
        mip: Amon
        field: T2Ms
        exp: historical
        ensemble: r1i1p1
        start_year: 2000
        end_year: 2000
        preprocessor: time_average
        label: DUMMY_TAS
        var_type: feature
        broadcast_from: [1, 2]
        additional_datasets:
          - {dataset: ERA-Interim, project: OBS, type: reanaly, version: 1, tier: 3, var_type: prediction_input}
    scripts:
      dummy:
        script: gbrt/dummy.py

  diag_gbrt:
    description: Perform GBRT on input data.
    variables:
      ta: &variable_settings
        project: CMIP5
        mip: Amon
        field: T3M
        exp: historical
        ensemble: r1i1p1
        start_year: 1979
        end_year: 2005
        preprocessor: time_average
        label: T
        var_type: feature
        additional_datasets:
          - {dataset: ERA-Interim, project: OBS, type: reanaly, version: 1, tier: 3, var_type: prediction_input}
          # - {dataset: CanESM2}
          # - {dataset: MPI-ESM-LR}
      tas:
        <<: *variable_settings
        label: TAS
        field: T2Ms
        broadcast_from: [1, 2]
        additional_datasets:
          - {dataset: ERA-Interim, project: OBS, type: reanaly, version: 1, tier: 3, var_type: prediction_input}
          # - {dataset: CanESM2}
          # - {dataset: MPI-ESM-LR}
      ua:
        <<: *variable_settings
        label: UA
        additional_datasets:
          - {dataset: ERA-Interim, project: OBS, type: reanaly, version: 1, tier: 3, var_type: prediction_input}
          - {dataset: CanESM2, exp: rcp45, start_year: 2015, end_year: 2034, var_type: label}
          - {dataset: MPI-ESM-LR, exp: rcp45, start_year: 2015, end_year: 2034, var_type: label}
    scripts:
      intra_model_gbrt:
        script: gbrt/intra_model.py
        ancestors: ['ta', 'tas', 'ua', 'diag_dummy/dummy']
        use_coords_as_feature:
          air_pressure: 0
          latitude: 1
          longitude: 2

  diag_austral_jet_position:
    description: Calculate Austral Jet position.
    scripts:
      austral_jet_position:
        script: austral_jet/jet_position.py
        ancestors: ['diag_gbrt/intra_model_gbrt']
